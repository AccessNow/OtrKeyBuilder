#!/bin/bash

# indique au système que l'argument qui suit est le programme utilisé pour exécuter ce fichier.
# En cas général les "#" servent à faire des commentaires comme ici


echo Now i am root
id
echo "yes!"

echo "You are in "
pwd

mkdir -p BUILD
cp -v ../tails-i386-0.18.iso BUILD

cd BUILD/
echo "You are in "
pwd

mkdir mnt
echo "passe22" | sudo -S mount -o loop tails-i386-0.18.iso mnt/
mkdir extract-cd
echo "passe22" | sudo -S rsync --exclude=/live/filesystem.squashfs -a mnt/ extract-cd
mkdir squashfs
echo "passe22" | sudo -S mount -t squashfs -o loop mnt/live/filesystem.squashfs squashfs
mkdir edit
echo "passe22" | sudo -S cp -av squashfs/* edit/ 2> hello

cd ..
echo "You are in "
pwd

echo "passe22" | sudo -S mkdir ./BUILD/edit/home/amnesia
echo "passe22" | sudo -S mkdir ./BUILD/edit/home/amnesia/.purple ./BUILD/edit/home/amnesia/.jitsi
echo "passe22" | sudo -S cp ./otr.private_key ./BUILD/edit/home/amnesia/.purple/
#cp /home/akram/.jitsi/* ./keys/.jitsi/
echo "passe22" | sudo -S cp ./sip-communicator.properties ./BUILD/edit/home/amnesia/.jitsi/

echo "Making squashfs..."
echo "passe22" | sudo -S mksquashfs ./BUILD/edit ./BUILD/extract-cd/live/filesystem.squashfs

echo "passe22" | sudo -S cd ./BUILD/extract-cd
echo "You are in "
pwd

echo "Building iso file ..."
echo "passe22" | sudo -S genisoimage -o monimage.iso -r -J -no-emul-boot -boot-load-size 4 -boot-info-table -b isolinux/isolinux.bin -c isolinux/boot.cat ./
ls -la
 
#exit 0
